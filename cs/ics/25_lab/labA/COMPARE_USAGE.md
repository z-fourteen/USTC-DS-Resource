# 对比脚本使用说明

这个项目包含两个对比脚本，用于检验你的汇编器输出是否正确。

## 🐍 Python 版本 (推荐)

**优点**: 跨平台、易读、支持更多特性

### 使用方法

```bash
python compare_results.py
```

或者直接在命令行运行：

```bash
python d:\05_fourteen\ustc-life\2025fall\lessons\ics\labA\compare_results.py
```

### 输出示例

```
🔍 LC-3 汇编器输出对比工具

📁 找到 3 个输出文件

================================================================================
✅ fibonacci.obj: 完全匹配 (76 行)

❌ test_add.obj: 有 2 行不匹配 (共 10 行)
   第一个不匹配在第 5 行:
   您的输出: 0001000000100000
   标准答案: 0001000000100001
   差异位置: 0x0001 (十六进制)

✅ multiplication.obj: 完全匹配 (45 行)

================================================================================

📊 总结:
   总文件数: 3
   ✅ 通过: 2
   ❌ 失败: 1
   成功率: 66.7%
```

---

## 💻 PowerShell 版本

**优点**: Windows 原生、集成度高

### 使用方法

打开 PowerShell 并运行：

```powershell
powershell -ExecutionPolicy Bypass -File compare_results.ps1
```

或者：

```powershell
Set-Location d:\05_fourteen\ustc-life\2025fall\lessons\ics\labA
.\compare_results.ps1
```

---

## 📋 脚本功能

两个脚本完全相同的功能：

1. **自动查找文件**
   - 扫描 `result/` 目录下所有 `.obj` 文件
   - 在 `test_case/bin/` 中查找对应的 `.asm.bin` 答案文件

2. **逐行对比**
   - 比较行数是否相同
   - 逐行对比机器码
   - 标记第一个不匹配的位置

3. **详细错误报告**
   - 显示你的输出与标准答案的差异
   - 计算二进制的差异位（用 XOR）
   - 以十六进制格式显示差异值

4. **汇总统计**
   - 显示通过/失败的文件数
   - 计算成功率

---

## 🔍 如何使用输出信息

### 完全匹配的文件
```
✅ fibonacci.obj: 完全匹配 (76 行)
```
这表示你的输出与标准答案完全相同 ✓

### 有差异的文件
```
❌ test_add.obj: 有 2 行不匹配 (共 10 行)
   第一个不匹配在第 5 行:
   您的输出: 0001000000100000
   标准答案: 0001000000100001
   差异位置: 0x0001 (十六进制)
```

**解读**:
- 你的输出与标准答案在第 5 行不同
- 你输出的是: `0001000000100000`
- 正确答案是: `0001000000100001`
- 差异在二进制的位 0 处（最低位）

---

## 💡 调试建议

如果某一行不匹配，可以这样排查：

1. **检查指令操作码** - 看看是否是错的指令
2. **检查操作数编码** - 寄存器、立即数、偏移量
3. **检查特殊标志位** - 如 ADD/AND 的立即数标志位（位5）
4. **检查地址计算** - 特别是分支指令的偏移量

---

## 📁 目录结构

```
labA/
├── result/              (你的程序输出)
│   ├── fibonacci.obj
│   ├── test_add.obj
│   └── ...
├── test_case/
│   └── bin/             (标准答案)
│       ├── fibonacci.asm.bin
│       ├── test_add.asm.bin
│       └── ...
├── compare_results.py   (Python 脚本)
├── compare_results.ps1  (PowerShell 脚本)
└── COMPARE_USAGE.md     (本文件)
```

---

## ⚠️ 常见问题

**Q: 脚本找不到文件？**
A: 确保你在正确的目录中运行脚本，或使用绝对路径

**Q: 为什么有些行不匹配但看起来一样？**
A: 可能是空格或换行符的问题，脚本会逐字节对比

**Q: 如何只检查特定文件？**
A: 修改脚本，在 `result/` 中只保留你要检查的 `.obj` 文件

---

祝调试顺利！🎉
